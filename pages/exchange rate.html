<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ–¤ğŸ’–é…·æ´›ç±³é¢¨åŒ¯ç‡ç‰Œåƒ¹</title>
    
    <style>
        /* é…·æ´›ç±³è‰²ç³»å®šç¾© */
        :root {
            --primary-black: #1a1a1a;
            --kuromi-pink: #f77fbe;
            --kuromi-purple: #9C89B8; /* å®˜æ–¹é…·æ´›ç±³ç´«è‰² */
            --background-white: #ffffff;
            --light-grey: #f0f0f0;
            --card-shadow: rgba(0, 0, 0, 0.25); /* é™°å½±åŠ æ·±ä¸€é»ï¼Œåœ¨æ·±è‰²èƒŒæ™¯ä¸Šæ›´çªå‡º */
            --buy-color: #2ecc71;
            --sell-color: #e74c3c;
            --text-on-purple: #f8f8f8; /* æ·ºè‰²æ–‡å­—ï¼Œç”¨æ–¼ç´«è‰²èƒŒæ™¯ä¸Šçš„ä¸»è¦æ–‡å­— */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--kuromi-purple); 
            margin: 0;
            padding: 20px 0;
            color: var(--primary-black);
            min-height: 100vh;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }

        #dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
            /* *** ç§»é™¤ç™½è‰²èƒŒæ™¯å’Œé™°å½± *** */
            /* background-color: var(--background-white); */
            /* box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); */
            padding-bottom: 20px;
        }

        /* è¨­ç½®ä¸€å€‹ flex å®¹å™¨ä¾†ç¢ºä¿ h1 å±…ä¸­ */
        .header-container {
            display: flex;
            justify-content: center; 
            width: 100%;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        /* ç¶²é æ¨™é¡Œæ¨£å¼ (ä¾ç„¶ä¿æŒç™½åº•ï¼Œä½†ç¾åœ¨ç›´æ¥åœ¨ç´«è‰²èƒŒæ™¯ä¸Š) */
        h1 {
            margin: 0; 
            color: var(--primary-black);
            font-weight: 700;
            font-size: 2em;
            display: inline-block; 
            padding: 10px 25px; 
            background-color: var(--background-white); 
            border-radius: 12px; 
            box-shadow: 0 0 15px var(--card-shadow); /* è®“æ¨™é¡Œæ›´çªå‡º */
        }

        /* è³‡è¨Šåˆ—ï¼šé¡¯ç¤ºæ•¸æ“šæ—¥æœŸ */
        #info-bar {
            /* *** ä¿æŒç™½åº•ï¼Œè®“è³‡è¨Šæ¸…æ™° *** */
            background-color: var(--background-white);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 0 10px var(--card-shadow); 
            margin-bottom: 20px;
            text-align: center;
            font-size: 1em;
            font-weight: bold;
        }

        /* --- è³‡è¨Šå¡ä½ˆå±€ (Grid) --- */
        #currency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding-bottom: 20px;
        }

        /* --- å–®å¼µè³‡è¨Šå¡ (Card) æ¨£å¼ --- */
        .currency-card {
            /* *** ä¿æŒç™½åº•ï¼Œè®“è³‡è¨Šå¡åœ¨ç´«è‰²èƒŒæ™¯ä¸Šæµ®ç¾ *** */
            background-color: var(--background-white);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px var(--card-shadow); /* å¢åŠ é™°å½±å¼·èª¿æµ®å‹•æ„Ÿ */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 5px solid var(--kuromi-pink); 
        }

        .currency-card:hover {
            transform: translateY(-5px); /* æ”¾å¤§ä¸Šæµ®æ•ˆæœ */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .currency-card h2 {
            margin-top: 0;
            color: var(--primary-black);
            font-size: 1.6em;
            padding-bottom: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        /* é›™å‘åŒ¯ç‡çš„å®¹å™¨ */
        .rate-direction {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid var(--light-grey);
            border-radius: 8px;
        }
        
        .rate-direction h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--kuromi-pink);
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--light-grey);
        }

        /* è²·å…¥/è³£å‡ºå®¹å™¨ */
        .rate-pair {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .rate-box {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            border-radius: 6px;
        }
        
        /* è²·å…¥åƒ¹æ¨£å¼ */
        .buy-box {
            background-color: #f3fcf6; 
        }

        /* è³£å‡ºåƒ¹æ¨£å¼ */
        .sell-box {
            background-color: #fff4f4; 
        }

        .rate-label {
            font-size: 0.8em;
            color: #555;
            display: block;
            margin-bottom: 3px;
        }

        .rate-value {
            font-size: 1.4em; 
            font-weight: 700;
        }
        
        .buy-box .rate-value {
            color: var(--buy-color);
        }
        
        .sell-box .rate-value {
            color: var(--sell-color);
        }

        #loader, #error-message {
            text-align: center;
            font-size: 1.2em;
            padding: 30px;
            color: var(--background-white); /* è®“è¼‰å…¥æ–‡å­—åœ¨ç´«è‰²èƒŒæ™¯ä¸Šèƒ½çœ‹è¦‹ */
        }
        
        .hidden {
            display: none !important;
        }
        
        /* è³‡æ–™ä¾†æºå€å¡Š */
        #source-disclaimer {
            margin-top: 40px;
            padding: 15px;
            /* *** ä¿æŒæ·±è‰²èƒŒæ™¯ï¼Œè®“æ–‡å­—åœ¨ç´«è‰²èƒŒæ™¯ä¸Šä¿æŒé«˜å°æ¯”åº¦ *** */
            background-color: var(--primary-black);
            color: var(--background-white);
            border-radius: 8px;
            box-shadow: 0 0 10px var(--card-shadow);
            font-size: 0.8em;
            line-height: 1.6;
        }
        
        #source-disclaimer a {
            color: var(--kuromi-pink);
            text-decoration: none;
        }

        /* æ‰‹æ©Ÿé©é…å„ªåŒ– */
        @media (max-width: 600px) {
            #currency-grid {
                grid-template-columns: 1fr;
            }
            .rate-pair {
                flex-direction: row; 
            }
            .rate-box {
                padding: 10px 5px;
            }
            .rate-value {
                font-size: 1.3em;
            }
            h1 {
                font-size: 1.5em;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    
    <div id="dashboard-container">
        <div class="header-container">
            <h1>ğŸ–¤ğŸ’– é…·æ´›ç±³é›™å‘åŒ¯ç‡ç‰Œåƒ¹</h1>
        </div>
        
        <div id="info-bar">
            </div>

        <div id="loader">æ­£åœ¨å¾åœ‹éš›æ•¸æ“šæºè¼‰å…¥åŒ¯ç‡ç‰Œåƒ¹...</div>
        
        <div id="currency-grid">
            </div>
        
        <div id="error-message" class="hidden">
            æŠ±æ­‰ï¼Œç„¡æ³•è¼‰å…¥åŒ¯ç‡æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚
        </div>
        
        <div id="source-disclaimer">
            <h3>è³‡æ–™ä¾†æºèˆ‡å…è²¬è²æ˜</h3>
            <p><strong>æ•¸æ“šä¾†æºï¼š</strong> æœ¬æ•¸æ“šåŸºæ–¼åœ‹éš›å…¬é–‹ API <a href="https://www.exchangerate-api.com/" target="_blank">ExchangeRate-API</a> æä¾›çš„åœ‹éš›ä¸­é–“åŒ¯ç‡ï¼Œ**ä¸å…·å‚™éŠ€è¡Œäº¤æ˜“çš„æ³•å®šæ•ˆåŠ›**ã€‚</p>
            <p><strong>è²·å…¥/è³£å‡ºï¼š</strong> è²·å…¥/è³£å‡ºåƒ¹æ ¼æ˜¯æ ¹æ“šåœ‹éš›ä¸­é–“åŒ¯ç‡**æ¨¡æ“¬**åˆç†åƒ¹å·® (Spread) æ‰€å¾—ï¼Œåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›äº¤æ˜“è«‹ä»¥å°ç£å„å¤§éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡ç‚ºæº–ã€‚</p>
        </div>
    </div>

    <script>
        const API_URL = "https://open.er-api.com/v6/latest/TWD";
        const BASE_CODE = "TWD";

        const TARGET_CURRENCIES = [
            { code: "JPY", name: "æ—¥åœ“", spread: 0.015, precision: 6 },
            { code: "USD", name: "ç¾é‡‘", spread: 0.008, precision: 4 },
            { code: "CNY", name: "äººæ°‘å¹£", spread: 0.005, precision: 4 },
            { code: "KRW", name: "éŸ“å…ƒ", spread: 0.012, precision: 6 },
            { code: "HKD", name: "æ¸¯å¹£", spread: 0.007, precision: 4 },
            { code: "EUR", name: "æ­å…ƒ", spread: 0.01, precision: 4 }
        ];

        const gridContainer = document.getElementById('currency-grid');
        const infoBar = document.getElementById('info-bar');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');

        async function fetchExchangeRates() {
            loader.classList.remove('hidden');
            gridContainer.innerHTML = '';
            errorMessage.classList.add('hidden');

            try {
                const response = await fetch(API_URL);
                const data = await response.json();

                if (data.result === 'success') {
                    displayRates(data);
                } else {
                    throw new Error('API æ•¸æ“šè¿”å›å¤±æ•—æˆ–è«‹æ±‚éŒ¯èª¤ã€‚');
                }

            } catch (error) {
                console.error("ç²å–åŒ¯ç‡æ™‚ç™¼ç”ŸéŒ¯èª¤:", error);
                errorMessage.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }
        
        function calculateRates(midRate, spread, decimalPlaces) {
            const bankSellRate = midRate * (1 + spread);
            const bankBuyRate = midRate * (1 - spread);
            
            return {
                buy: bankBuyRate.toFixed(decimalPlaces), 
                sell: bankSellRate.toFixed(decimalPlaces) 
            };
        }

        function displayRates(data) {
            const rates = data.rates;
            
            const date = new Date(data.time_last_update_utc).toLocaleDateString('zh-TW', {
                year: 'numeric', month: 'long', day: 'numeric'
            });

            infoBar.innerHTML = `
                æœ€æ–°ç‰Œåƒ¹æ•¸æ“šæ—¥æœŸï¼š<strong>${date}</strong>
            `;

            TARGET_CURRENCIES.forEach(currency => {
                const rateToBase = rates[currency.code]; 
                
                if (rateToBase) {
                    const CCODE = currency.code; 
                    const DEC = currency.precision; 
                    
                    /* --- 1. è¨ˆç®— 1 å¤–å¹£ (CCODE) = å¤šå°‘ TWD --- */
                    const midRate_CCODE_to_TWD = 1 / rateToBase; 
                    const { buy: twdBuy, sell: twdSell } = calculateRates(midRate_CCODE_to_TWD, currency.spread, DEC);
                    
                    /* --- 2. è¨ˆç®— 1 TWD = å¤šå°‘ å¤–å¹£ (CCODE) --- */
                    const twd_buy_ccode = (1 / twdSell).toFixed(DEC); 
                    const twd_sell_ccode = (1 / twdBuy).toFixed(DEC); 
                    
                    const cardHTML = `
                        <div class="currency-card">
                            <h2>${currency.name} (${CCODE})</h2>
                            
                            <div class="rate-direction">
                                <h3>1 ${CCODE} = ${BASE_CODE}</h3>
                                <div class="rate-pair">
                                    <div class="rate-box buy-box">
                                        <span class="rate-label">éŠ€è¡Œè²·å…¥ (Bank Buy)</span>
                                        <span class="rate-value">${twdBuy}</span>
                                    </div>
                                    
                                    <div class="rate-box sell-box">
                                        <span class="rate-label">éŠ€è¡Œè³£å‡º (Bank Sell)</span>
                                        <span class="rate-value">${twdSell}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="rate-direction">
                                <h3>1 ${BASE_CODE} = ${CCODE}</h3>
                                <div class="rate-pair">
                                    <div class="rate-box buy-box">
                                        <span class="rate-label">éŠ€è¡Œè²·å…¥ (Bank Buy)</span>
                                        <span class="rate-value">${twd_sell_ccode}</span> 
                                    </div>
                                    
                                    <div class="rate-box sell-box">
                                        <span class="rate-label">éŠ€è¡Œè³£å‡º (Bank Sell)</span>
                                        <span class="rate-value">${twd_buy_ccode}</span> 
                                    </div>
                                </div>
                            </div>

                        </div>
                    `;
                    gridContainer.insertAdjacentHTML('beforeend', cardHTML);
                }
            });
        }

        window.onload = function() {
            fetchExchangeRates(); 
        }
    </script>
</body>
</html>
